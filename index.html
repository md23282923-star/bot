<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TTE ELITE - MONETAG VERSION</title>
    
    <script src='//libtl.com/sdk.js' data-zone='10499994' data-sdk='show_10499994'></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">

    <style>
        :root { --bg: #0b0f19; --card: #161b2a; --gold: #fbbf24; --text: #f8fafc; --accent: #3b82f6; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Poppins', sans-serif; margin: 0; overflow: hidden; height: 100vh; }

        /* UI ELEMENTS */
        .app-screen { height: calc(100vh - 80px); overflow-y: auto; padding: 20px; display: none; padding-bottom: 100px; }
        .active-screen { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* COIN */
        .coin-wrapper { display: flex; justify-content: center; margin: 25px 0; }
        .css-coin {
            width: 220px; height: 220px; border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #fcd34d, #b45309);
            border: 8px solid #78350f;
            box-shadow: inset 0 0 20px rgba(255,255,255,0.5), 0 10px 30px rgba(0,0,0,0.6);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: transform 0.05s;
        }
        .css-coin:active { transform: scale(0.92); }
        .coin-symbol { font-size: 50px; font-weight: 900; color: #78350f; }

        .stat-box { background: var(--card); padding: 10px; border-radius: 12px; font-size: 14px; }
        .big-balance { text-align: center; font-size: 40px; font-weight: 900; margin: 15px 0; }

        .btn-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .action-btn { background: var(--card); border-radius: 15px; padding: 12px; text-align: center; font-size: 10px; font-weight: 700; cursor: pointer; border: 1px solid #2d3748; }
        .action-btn i { font-size: 20px; color: var(--gold); margin-bottom: 5px; display: block; }

        .energy-bar-bg { background: #1e293b; height: 10px; border-radius: 10px; margin-top: 15px; overflow: hidden; }
        .energy-fill { background: linear-gradient(90deg, var(--gold), #d97706); height: 100%; width: 100%; transition: 0.3s; }

        /* MODAL */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; align-items: center; justify-content: center; flex-direction: column; }
        .wheel-box { 
            width: 260px; height: 260px; border-radius: 50%; border: 5px solid #fff;
            background: conic-gradient(#3b82f6 0 72deg, #ef4444 72deg 144deg, #fbbf24 144deg 216deg, #22c55e 216deg 288deg, #a855f7 288deg 360deg);
            transition: transform 4s cubic-bezier(0.1, 0, 0.1, 1);
        }

        .card { background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid rgba(255,255,255,0.05); }
        .btn-p { background: var(--accent); color: white; border: none; padding: 10px 15px; border-radius: 8px; font-weight: 700; }
        .inp { width: 100%; padding: 12px; background: #0b0f19; border: 1px solid #2d3748; color: white; border-radius: 8px; margin-bottom: 10px; }

        .navbar { position: fixed; bottom: 0; width: 100%; height: 70px; background: #0b0f19; border-top: 1px solid #1e293b; display: flex; justify-content: space-around; align-items: center; }
        .nav-item { color: #64748b; font-size: 10px; text-align: center; }
        .nav-item.active { color: var(--gold); }
        .nav-item i { font-size: 20px; display: block; }

        .pop { position: absolute; font-weight: 900; color: white; animation: float 0.7s forwards; pointer-events: none; }
        @keyframes float { to { transform: translateY(-80px); opacity: 0; } }
    </style>
</head>
<body>

    <div id="scr-mine" class="app-screen active-screen">
        <div style="display:flex; justify-content: space-between;">
            <div class="stat-box">ðŸ’Ž <span id="elite-val">0.00</span></div>
            <div class="stat-box">âš¡ Boost: <span id="b-timer">OFF</span></div>
        </div>
        <div class="big-balance" id="bal-main">0</div>
        <div class="coin-wrapper"><div class="css-coin" onclick="handleTap(event)"><div class="coin-symbol">TTE</div></div></div>
        <div class="btn-grid">
            <div class="action-btn" onclick="showMonetagAd('boost')"><i class="fas fa-rocket"></i>BOOST</div>
            <div class="action-btn" onclick="showSpin()"><i class="fas fa-dharmachakra"></i>SPIN</div>
            <div class="action-btn" onclick="nav('scr-tasks', this)"><i class="fas fa-tasks"></i>TASKS</div>
        </div>
        <div style="margin-top:20px; font-size:12px;">Energy: <span id="en-txt">1000/1000</span></div>
        <div class="energy-bar-bg"><div id="en-fill" class="energy-fill"></div></div>
    </div>

    <div id="scr-tasks" class="app-screen"><h2>TASKS</h2><div id="task-list"></div></div>
    <div id="scr-ref" class="app-screen"><h2>REFERRAL</h2><input type="text" id="ref-link" class="inp" readonly><button class="btn-p" style="width:100%" onclick="copyRef()">COPY LINK</button></div>
    <div id="scr-wallet" class="app-screen"><h2>WALLET</h2><div class="card" style="display:block; text-align:center;"><h1>ðŸ’Ž <span id="elite-wallet">0.00</span></h1><button class="btn-p" onclick="swap()">SWAP 1M TTE</button></div><input type="text" id="ton-addr" class="inp" placeholder="TON Address"><button class="btn-p" style="width:100%" onclick="saveW()">SAVE</button></div>

    <div id="scr-admin" class="app-screen">
        <h2>ADMIN</h2>
        <div class="card" style="display:block;"><input type="text" id="ad-t" placeholder="Title" class="inp"><input type="text" id="ad-l" placeholder="Link" class="inp"><input type="number" id="ad-r" placeholder="Reward" class="inp"><button class="btn-p" style="width:100%" onclick="addTask()">ADD TASK</button></div>
        <div id="ad-task-list"></div>
    </div>

    <div id="spin-modal" class="modal">
        <div id="wheel" class="wheel-box"></div>
        <div style="margin-top:20px; text-align:center;">
            <p>Spins: <span id="spin-count">0</span></p>
            <button class="btn-p" onclick="spinNow()">SPIN</button>
            <button class="btn-p" style="background:#444" onclick="closeSpin()">BACK</button>
            <button class="btn-p" style="display:block; width:100%; margin-top:10px; background:var(--gold); color:black;" onclick="showMonetagAd('spin')">AD FOR SPIN</button>
        </div>
    </div>

    <nav class="navbar">
        <div class="nav-item active" onclick="nav('scr-mine', this)"><i class="fas fa-hammer"></i>Mine</div>
        <div class="nav-item" onclick="nav('scr-tasks', this)"><i class="fas fa-tasks"></i>Tasks</div>
        <div class="nav-item" onclick="nav('scr-ref', this)"><i class="fas fa-users"></i>Refer</div>
        <div class="nav-item" onclick="nav('scr-wallet', this)"><i class="fas fa-wallet"></i>Wallet</div>
    </nav>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyAn1mn3IZ6eReChizrKIZvCBt4zkOn_svU", authDomain: "tte-game.firebaseapp.com", databaseURL: "https://tte-game-default-rtdb.firebaseio.com", projectId: "tte-game", storageBucket: "tte-game.firebasestorage.app", messagingSenderId: "1067385955645", appId: "1:1067385955645:web:09b237ceaf180459311154" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database(), tg = window.Telegram.WebApp;
        const ADMIN_ID = "7178946316", userId = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id.toString() : "test_user";

        let u = { bal: 0, elite: 0, energy: 1000, spins: 0, bUntil: 0, wallet: "" };

        db.ref('users/' + userId).on('value', s => { if(s.val()){ u = {...u, ...s.val()}; updateUI(); } else { db.ref('users/'+userId).set(u); }});

        if(userId === ADMIN_ID) {
            const navB = document.querySelector('.navbar');
            const adI = document.createElement('div'); adI.className='nav-item'; adI.innerHTML='<i class="fas fa-user-shield"></i>Admin';
            adI.onclick=()=>nav('scr-admin', adI); navB.appendChild(adI); loadAdmin();
        }

        // MONETAG REWARDED AD FUNCTION
        function showMonetagAd(type) {
            show_10499994().then(() => {
                // Reward logic after successful ad watch
                if(type === 'boost') { u.bUntil = Date.now() + (12 * 60 * 60 * 1000); tg.showAlert("ðŸ”¥ 12H Boost Active!"); }
                else if(type === 'spin') { u.spins++; tg.showAlert("ðŸŽ +1 Spin Added!"); }
                db.ref('users/'+userId).update({bUntil: u.bUntil, spins: u.spins});
            }).catch(e => { tg.showAlert("Ad not ready yet!"); });
        }

        function handleTap(e) {
            let p = (Date.now() < u.bUntil) ? 2 : 1;
            if(u.energy >= p) {
                u.bal += p; u.energy -= p;
                const x = e.touches ? e.touches[0].clientX : e.clientX, y = e.touches ? e.touches[0].clientY : e.clientY;
                const t = document.createElement('div'); t.className='pop'; t.style.left=x+'px'; t.style.top=y+'px'; t.innerText='+'+p;
                document.body.appendChild(t); setTimeout(()=>t.remove(), 700);
                tg.HapticFeedback.impactOccurred('light');
                db.ref('users/'+userId).update({bal: u.bal, energy: u.energy});
            }
        }

        function showSpin() { document.getElementById('spin-modal').style.display='flex'; }
        function closeSpin() { document.getElementById('spin-modal').style.display='none'; }
        function spinNow() {
            if(u.spins <= 0) return tg.showAlert("No Spins!");
            const w = document.getElementById('wheel'); let deg = 3600 + Math.floor(Math.random()*360);
            w.style.transform = `rotate(${deg}deg)`; u.spins--;
            db.ref('users/'+userId).update({spins: u.spins});
            setTimeout(() => {
                let win = 1000; u.bal += win; db.ref('users/'+userId).update({bal: u.bal});
                tg.showAlert("Won 1000 TTE!"); w.style.transition='none'; w.style.transform='rotate(0deg)';
                setTimeout(()=>w.style.transition='4s cubic-bezier(0.1, 0, 0.1, 1)', 50);
            }, 4100);
        }

        function updateUI() {
            document.getElementById('bal-main').innerText = Math.floor(u.bal).toLocaleString();
            document.getElementById('elite-val').innerText = u.elite.toFixed(2);
            document.getElementById('elite-wallet').innerText = u.elite.toFixed(2);
            document.getElementById('spin-count').innerText = u.spins;
            document.getElementById('en-txt').innerText = u.energy + "/1000";
            document.getElementById('en-fill').style.width = (u.energy/10) + "%";
            document.getElementById('ref-link').value = "https://t.me/taptoearn_tte_bot?start=" + userId;
            document.getElementById('b-timer').innerText = (Date.now() < u.bUntil) ? "ACTIVE" : "OFF";
        }

        function nav(id, el) {
            document.querySelectorAll('.app-screen').forEach(s => s.style.display='none');
            document.getElementById(id).style.display='block';
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        }

        db.ref('tasks').on('value', s => {
            const list = document.getElementById('task-list'); list.innerHTML = "";
            if(s.val()) Object.values(s.val()).forEach(t => {
                list.innerHTML += `<div class="card"><div><b>${t.title}</b><br><small>+${t.reward}</small></div><button class="btn-p" onclick="tg.openLink('${t.link}')">GO</button></div>`;
            });
        });

        function addTask() {
            const t = document.getElementById('ad-t').value, l = document.getElementById('ad-l').value, r = document.getElementById('ad-r').value;
            if(t && l && r) { const id = 't_'+Date.now(); db.ref('tasks/'+id).set({id, title:t, link:l, reward:parseInt(r)}); }
        }

        function loadAdmin() {
            db.ref('tasks').on('value', s => {
                const al = document.getElementById('ad-task-list'); al.innerHTML = "";
                if(s.val()) Object.values(s.val()).forEach(t => { al.innerHTML += `<div class="card"><span>${t.title}</span><button onclick="db.ref('tasks/${t.id}').remove()" style="background:red;border:none;color:white;">DEL</button></div>`; });
            });
        }

        setInterval(() => { if(u.energy < 1000) { u.energy++; updateUI(); }}, 2000);
        function copyRef() { document.getElementById('ref-link').select(); document.execCommand('copy'); tg.showAlert("Copied!"); }
        function swap() { if(u.bal >= 1000000) { u.bal -= 1000000; u.elite += 0.1; db.ref('users/'+userId).update({bal:u.bal, elite:u.elite}); } else { tg.showAlert("Need 1M!"); }}
    </script>
</body>
</html>
