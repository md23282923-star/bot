<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TTE ELITE - Official</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://sad.adsgram.ai/js/adsgram-ad-sdk.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --primary-gold: #ffcc00; --bg-color: #0b0c10; --card-bg: #1f2833; --text-color: #ffffff; }
        body { background: var(--bg-color); color: var(--text-color); font-family: 'Inter', sans-serif; margin: 0; overflow: hidden; user-select: none; }
        .header { display: flex; justify-content: space-between; padding: 15px; background: rgba(255,255,255,0.05); border-bottom: 1px solid rgba(255,255,255,0.1); }
        .badge { background: #333; padding: 5px 12px; border-radius: 20px; font-size: 12px; border: 1px solid var(--primary-gold); cursor: pointer; }
        #admin-panel { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 10000; padding: 25px; box-sizing: border-box; overflow-y: auto; }
        .page { display: none; height: 85vh; overflow-y: auto; padding: 20px; box-sizing: border-box; padding-bottom: 150px; }
        .active-page { display: block; animation: fadeIn 0.4s; }
        .balance-container { text-align: center; margin: 30px 0; }
        .balance-container h1 { font-size: 50px; margin: 0; background: linear-gradient(to bottom, #fff, #888); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 900; }
        #main-coin { width: 220px; height: 220px; background: radial-gradient(circle, #333 0%, #000 70%); border-radius: 50%; border: 8px solid #1a1a1a; margin: 0 auto; display: flex; align-items: center; justify-content: center; transition: 0.1s; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
        #main-coin:active { transform: scale(0.95); border-color: var(--primary-gold); }
        #main-coin img { width: 120px; filter: drop-shadow(0 0 10px var(--primary-gold)); }
        .store-card { background: var(--card-bg); border-radius: 15px; padding: 15px; margin-bottom: 15px; border-left: 5px solid var(--primary-gold); display: flex; justify-content: space-between; align-items: center; }
        .btn-gold { padding: 10px 20px; border: none; border-radius: 8px; font-weight: bold; background: var(--primary-gold); color: black; cursor: pointer; }
        .footer-nav { position: fixed; bottom: 0; width: 100%; height: 80px; background: #111; display: flex; border-top: 1px solid #222; }
        .nav-item { color: #555; font-size: 11px; text-align: center; flex: 1; padding: 15px 0; cursor: pointer; }
        .nav-item.active { color: var(--primary-gold); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="admin-panel">
        <h2 style="color: var(--primary-gold);">Admin Dashboard</h2>
        <div style="background:#111; padding:15px; border-radius:10px; border:1px solid #333; margin-bottom:15px;">
            <p>Total Registered Users: <b id="stat-total-users" style="color:var(--primary-gold)">0</b></p>
        </div>
        <div style="background:#111; padding:15px; border-radius:10px; border:1px solid #333;">
            <h3>Update Live Task</h3>
            <input type="text" id="adm-task-name" placeholder="Task Name" style="width:100%; padding:10px; margin-bottom:10px; background:#222; color:white; border:1px solid #444;">
            <input type="text" id="adm-task-link" placeholder="Telegram Link" style="width:100%; padding:10px; margin-bottom:10px; background:#222; color:white; border:1px solid #444;">
            <input type="number" id="adm-task-reward" placeholder="Reward Points" style="width:100%; padding:10px; margin-bottom:10px; background:#222; color:white; border:1px solid #444;">
            <button class="btn-gold" onclick="saveAdminTask()" style="width:100%;">SAVE TASK</button>
        </div>
        <button onclick="document.getElementById('admin-panel').style.display='none'" style="width:100%; margin-top:20px; background:none; border:none; color:#666;">Close Panel</button>
    </div>

    <div class="header">
        <div class="badge" onclick="adminTrigger()">Lvl 1 Bronze</div>
        <div style="color: var(--primary-gold); font-weight: bold; letter-spacing: 1px;">TAP TO ELITE</div>
        <div class="badge"><i class="fas fa-wallet"></i> Wallet</div>
    </div>

    <div id="home" class="page active-page">
        <div class="balance-container">
            <h1 id="balance">0</h1>
            <p style="color:var(--primary-gold); font-weight:bold; font-size:12px; letter-spacing:2px;">TTE TOKENS</p>
        </div>
        <div id="main-coin"><img src="https://cdn-icons-png.flaticon.com/512/8727/8727924.png"></div>
        <div style="margin-top: 30px; text-align:center;">
            <p style="font-size:14px; color:#aaa;">⚡ Energy: <span id="energy" style="color:white">1000</span>/1000</p>
            <div style="width:100%; height:8px; background:#222; border-radius:10px;"><div id="energy-bar" style="width:100%; height:100%; background:var(--primary-gold); border-radius:10px;"></div></div>
        </div>
    </div>

    <div id="friends" class="page">
        <h2>Invite Friends</h2>
        <div class="store-card">
            <div><p style="margin:0;">Referral Bonus</p><h3 style="margin:5px 0;">+5,000 TTE</h3></div>
            <button class="btn-gold" onclick="copyRef()">Invite</button>
        </div>
        <p>Your Referrals: <b id="ref-count" style="color:var(--primary-gold)">0</b></p>
    </div>

    <div id="earn" class="page">
        <h2>Daily Missions</h2>
        <div class="store-card">
            <div><p style="margin:0;">Watch & Earn</p><h3 style="margin:5px 0;">Video Ad</h3><p style="color:#aaa; font-size:12px;">+5,000 TTE</p></div>
            <button class="btn-gold" onclick="showAd()">Watch</button>
        </div>
        <div id="live-task-card" class="store-card" style="display:none;">
            <div><p style="margin:0;">Community Task</p><h3 id="display-task-name" style="margin:5px 0;">Join Channel</h3><p id="display-task-reward" style="color:#aaa; font-size:12px;">+10,000 TTE</p></div>
            <button class="btn-gold" onclick="doTask()">Go</button>
        </div>
    </div>

    <div class="footer-nav">
        <div class="nav-item active" onclick="nav('home', this)"><i class="fas fa-hammer"></i><br>Mine</div>
        <div class="nav-item" onclick="nav('friends', this)"><i class="fas fa-user-friends"></i><br>Friends</div>
        <div class="nav-item" onclick="nav('earn', this)"><i class="fas fa-tasks"></i><br>Missions</div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyAN1mn3IZ6eReChizrKIZvCBt4zkOn_svU",
            authDomain: "tte-game.firebaseapp.com",
            databaseURL: "https://tte-game-default-rtdb.firebaseio.com",
            projectId: "tte-game",
            storageBucket: "tte-game.firebasestorage.app",
            messagingSenderId: "1067385955645",
            appId: "1:1067385955645:web:09b237ceaf180459311154"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Adsgram Block ID: 21556 (স্ক্রিনশট থেকে প্রাপ্ত)
        const AdController = window.Adsgram.init({ blockId: "21556" });

        const tg = window.Telegram.WebApp;
        tg.expand();
        const userId = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : "test_user";
        const firstName = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.first_name : "Player";

        let balance = 0, energy = 1000, adminClicks = 0;
        let currentTask = null;

        // --- USER SYNC & REFERRAL ---
        db.ref('users/' + userId).once('value', snap => {
            if(!snap.exists()) {
                let refBy = tg.initDataUnsafe.start_param;
                if(refBy && refBy != userId) {
                    db.ref('users/' + refBy).once('value', s => {
                        if(s.exists()) {
                            db.ref('users/' + refBy).update({
                                balance: (s.val().balance || 0) + 5000,
                                refCount: (s.val().refCount || 0) + 1
                            });
                        }
                    });
                }
                db.ref('users/' + userId).set({ balance: 0, name: firstName, refCount: 0 });
            }
        });

        db.ref('users/' + userId).on('value', snap => {
            if(snap.exists()) {
                balance = snap.val().balance || 0;
                document.getElementById('balance').innerText = balance.toLocaleString();
                document.getElementById('ref-count').innerText = snap.val().refCount || 0;
            }
        });

        // --- ADMIN TASK SYNC ---
        db.ref('adminSettings/task').on('value', snap => {
            if(snap.exists()) {
                currentTask = snap.val();
                document.getElementById('live-task-card').style.display = 'flex';
                document.getElementById('display-task-name').innerText = currentTask.name;
                document.getElementById('display-task-reward').innerText = "+" + parseInt(currentTask.reward).toLocaleString() + " TTE";
            }
        });

        // --- CORE FUNCTIONS ---
        document.getElementById('main-coin').addEventListener('touchstart', (e) => {
            e.preventDefault();
            if(energy >= 1) {
                balance++; energy--;
                db.ref('users/' + userId).update({ balance: balance });
                updateUI();
            }
        });

        function showAd() {
            AdController.show().then(() => {
                balance += 5000;
                db.ref('users/' + userId).update({ balance: balance });
                tg.showAlert("Success! You earned 5,000 TTE tokens.");
            }).catch(() => {
                tg.showAlert("No ads available right now. Please try again later.");
            });
        }

        function doTask() {
            if(currentTask) {
                window.open(currentTask.link, "_blank");
                tg.showConfirm("Did you join?", (ok) => {
                    if(ok) {
                        balance += parseInt(currentTask.reward);
                        db.ref('users/' + userId).update({ balance: balance });
                        tg.showAlert("Task reward added!");
                    }
                });
            }
        }

        function copyRef() {
            const link = `https://t.me/taptoearn_tte_bot/start?startapp=${userId}`;
            const el = document.createElement('textarea');
            el.value = link; document.body.appendChild(el);
            el.select(); document.execCommand('copy');
            document.body.removeChild(el);
            tg.showAlert("Referral link copied to clipboard!");
        }

        function nav(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.getElementById(id).classList.add('active-page');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        }

        function adminTrigger() {
            adminClicks++;
            if(adminClicks >= 5) {
                if(prompt("Admin Password:") === "7860") {
                    document.getElementById('admin-panel').style.display = 'block';
                    db.ref('users').once('value', s => {
                        document.getElementById('stat-total-users').innerText = s.numChildren();
                    });
                }
                adminClicks = 0;
            }
        }

        function saveAdminTask() {
            const name = document.getElementById('adm-task-name').value;
            const link = document.getElementById('adm-task-link').value;
            const reward = document.getElementById('adm-task-reward').value;
            if(name && link && reward) {
                db.ref('adminSettings/task').set({ name, link, reward: parseInt(reward) });
                alert("Task Updated Successfully!");
            }
        }

        setInterval(() => { if(energy < 1000) { energy = Math.min(1000, energy + 2); updateUI(); } }, 1500);
        function updateUI() {
            document.getElementById('energy').innerText = energy;
            document.getElementById('energy-bar').style.width = (energy / 10) + "%";
        }
    </script>
</body>
</html>
