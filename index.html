<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TTE ELITE</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://sad.adsgram.ai/js/adsgram-ad-sdk.js"></script>
    <style>
        body { background: #0b0c10; color: white; font-family: sans-serif; margin: 0; text-align: center; user-select: none; touch-action: manipulation; }
        .header { display: flex; justify-content: space-between; padding: 15px; background: #1f2833; }
        #main-coin { width: 220px; height: 220px; background: radial-gradient(#444, #000); border-radius: 50%; margin: 50px auto; border: 8px solid #ffcc00; display: flex; align-items: center; justify-content: center; transition: 0.1s; }
        #main-coin:active { transform: scale(0.95); }
        .page { display: none; padding: 20px; }
        .active-page { display: block; }
        .footer { position: fixed; bottom: 0; width: 100%; height: 70px; background: #111; display: flex; border-top: 1px solid #333; }
        .nav-item { flex: 1; padding: 15px; color: #555; }
        .nav-item.active { color: #ffcc00; }
    </style>
</head>
<body>
    <div class="header">
        <div onclick="adminTrigger()">Level 1</div>
        <div id="top-balance">0</div>
    </div>

    <div id="home" class="page active-page">
        <h1 id="balance">0</h1>
        <div id="main-coin" onclick="handleTap()">
            <img src="https://cdn-icons-png.flaticon.com/512/8727/8727924.png" width="120">
        </div>
        <p>⚡ Energy: <span id="energy">1000</span>/1000</p>
    </div>

    <div id="earn" class="page">
        <h2>Missions</h2>
        <button style="background:#ffcc00; padding:15px; border-radius:10px; font-weight:bold;" onclick="showAd()">Watch Video (+5000)</button>
    </div>

    <div class="footer">
        <div class="nav-item active" onclick="nav('home', this)">Earn</div>
        <div class="nav-item" onclick="nav('earn', this)">Missions</div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAN1mn3IZ6eReChizrKIZvCBt4zkOn_svU",
            authDomain: "tte-game.firebaseapp.com",
            databaseURL: "https://tte-game-default-rtdb.firebaseio.com",
            projectId: "tte-game",
            storageBucket: "tte-game.firebasestorage.app",
            messagingSenderId: "1067385955645",
            appId: "1:1067385955645:web:09b237ceaf180459311154"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const tg = window.Telegram.WebApp;
        tg.expand();

        // আপনার UnitID: 21556 ব্যবহার করা হয়েছে
        const AdController = window.Adsgram.init({ blockId: "21556" });

        const userId = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : "guest";
        let balance = 0, energy = 1000;

        // ডেটা লোড করা
        db.ref('users/' + userId).on('value', (snap) => {
            if (snap.exists()) {
                balance = snap.val().balance || 0;
                document.getElementById('balance').innerText = balance;
                document.getElementById('top-balance').innerText = balance;
            } else {
                db.ref('users/' + userId).set({ balance: 0, name: "Player" });
            }
        });

        function handleTap() {
            if (energy > 0) {
                balance++; energy--;
                document.getElementById('balance').innerText = balance;
                document.getElementById('energy').innerText = energy;
                // সাথে সাথে ডাটাবেসে সেভ হবে
                db.ref('users/' + userId).update({ balance: balance });
            }
        }

        function showAd() {
            AdController.show().then(() => {
                balance += 5000;
                db.ref('users/' + userId).update({ balance: balance });
                tg.showAlert("✅ 5,000 Points Added!");
            }).catch(() => tg.showAlert("❌ Ad not ready."));
        }

        function nav(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.getElementById(id).classList.add('active-page');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        }
    </script>
</body>
</html>

