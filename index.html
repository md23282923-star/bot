<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>TTE - The Elite Airdrop</title>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
:root{--primary-gold:#ffcc00;--bg:#0b0c10;--card:#1f2833}
body{background:var(--bg);color:#fff;margin:0;font-family:Arial}
.page{display:none}
.active-page{display:block}
#tap-hero{width:240px;height:240px;border-radius:50%;margin:20px auto;background:#111;display:flex;align-items:center;justify-content:center;border:6px solid #222}
#tap-hero img{width:140px}
.nav-bar{position:fixed;bottom:0;width:100%;height:70px;background:#000;display:flex}
.nav-btn{flex:1;text-align:center;font-size:12px;color:#777}
.nav-btn.active{color:var(--primary-gold)}
</style>
</head>

<body>

<div id="home" class="page active-page">
  <h1 id="bal" style="text-align:center">0</h1>
  <div id="tap-hero"><img src="https://cdn-icons-png.flaticon.com/512/8727/8727924.png"></div>
  <p style="text-align:center">‚ö° Energy: <span id="eng">1000</span></p>
  <button onclick="claimDaily()">üéÅ Daily Reward</button>
</div>

<div id="leader" class="page">
  <h3>üèÜ Leaderboard</h3>
  <div id="leaderboard"></div>
</div>

<div class="nav-bar">
  <div class="nav-btn active" onclick="showPage('home',this)">Earn</div>
  <div class="nav-btn" onclick="showPage('leader',this);loadLeaderboard()">Rank</div>
</div>

<script>
/* ================= INIT ================= */
const tg = window.Telegram.WebApp;
tg.expand();

const firebaseConfig = {
  apiKey: "AIzaSyAn1mn3IZ6eReChizrKIZvCBt4zkOn_svU",
  authDomain: "tte-game.firebaseapp.com",
  databaseURL: "https://tte-game-default-rtdb.firebaseio.com",
  projectId: "tte-game"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ================= USER ================= */
const userId = tg.initDataUnsafe?.user?.id || "guest_"+Math.random();
const username = tg.initDataUnsafe?.user?.username || "anon";
const userRef = db.ref("users/"+userId);

/* ================= STATE ================= */
let balance=0,energy=1000,streak=0,lastClaim="",lastTap=0;

/* ================= LOAD ================= */
userRef.once("value").then(s=>{
 if(!s.exists()){
  userRef.set({balance:0,energy:1000,streak:0,lastClaim:"",username});
 }else{
  let d=s.val();
  balance=d.balance||0;
  energy=d.energy||1000;
  streak=d.streak||0;
  lastClaim=d.lastClaim||"";
 }
 updateUI();
});

/* ================= TAP + ANTI BOT ================= */
document.getElementById("tap-hero").onclick=()=>{
 let now=Date.now();
 if(now-lastTap<80)return;
 lastTap=now;
 if(energy<=0)return;

 balance++;
 energy--;
 userRef.update({balance,energy});
 updateUI();
};

/* ================= ENERGY REGEN ================= */
setInterval(()=>{
 if(energy<1000){
  energy+=2;
  userRef.update({energy});
  updateUI();
 }
},1500);

/* ================= DAILY + STREAK ================= */
function claimDaily(){
 let today=new Date().toISOString().slice(0,10);
 if(today===lastClaim){alert("Already claimed");return;}

 let y=new Date(Date.now()-86400000).toISOString().slice(0,10);
 streak=(lastClaim===y)?streak+1:1;

 let reward=streak>=7?10000:streak*1000;
 balance+=reward;
 lastClaim=today;

 userRef.update({balance,streak,lastClaim});
 alert("Daily +"+reward+" TTE");
 updateUI();
}

/* ================= REFERRAL ================= */
let sp=tg.initDataUnsafe?.start_param;
if(sp && sp.startsWith("ref_")){
 let ref=sp.replace("ref_","");
 userRef.child("refBy").once("value",r=>{
  if(!r.exists() && ref!==userId){
   userRef.update({refBy:ref,balance:balance+10000});
   db.ref("users/"+ref+"/balance").transaction(n=>(n||0)+20000);
  }
 });
}

/* ================= LEADERBOARD ================= */
function loadLeaderboard(){
 db.ref("users").orderByChild("balance").limitToLast(10).once("value",s=>{
  let html="";
  s.forEach(u=>{
   html=`<p>${u.val().username} : ${u.val().balance}</p>`+html;
  });
  document.getElementById("leaderboard").innerHTML=html;
 });
}

/* ================= UI ================= */
function updateUI(){
 document.getElementById("bal").innerText=balance;
 document.getElementById("eng").innerText=energy;
}
function showPage(id,el){
 document.querySelectorAll(".page").forEach(p=>p.classList.remove("active-page"));
 document.getElementById(id).classList.add("active-page");
 document.querySelectorAll(".nav-btn").forEach(b=>b.classList.remove("active"));
 el.classList.add("active");
}
</script>
</body>
</html>
