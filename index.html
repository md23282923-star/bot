<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TTE ELITE - AIRDROP EDITION</title>
    
    <script src='//libtl.com/sdk.js' data-zone='10499994' data-sdk='show_10499994'></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

    <style>
        :root { --bg: #05070a; --glass: rgba(255, 255, 255, 0.05); --gold: #ffcc00; --accent: #00d2ff; --text: #ffffff; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }
        body { background: var(--bg); color: var(--text); font-family: 'Poppins', sans-serif; margin: 0; overflow: hidden; height: 100vh; }

        .top-nav { display: flex; justify-content: space-between; padding: 15px; background: rgba(0,0,0,0.5); border-bottom: 1px solid var(--glass); }
        .chip { background: var(--glass); padding: 8px 12px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); font-size: 12px; font-weight: 700; display: flex; align-items: center; gap: 5px; }

        .app-screen { height: calc(100vh - 85px); overflow-y: auto; padding: 20px; display: none; padding-bottom: 100px; }
        .active-screen { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .airdrop-banner { background: linear-gradient(90deg, #7b2ff7, #2d1b4e); padding: 10px; border-radius: 10px; text-align: center; font-size: 11px; font-weight: 700; margin-bottom: 15px; border: 1px solid #9d50bb; }

        .balance-container { text-align: center; margin: 10px 0; }
        .balance-container h1 { font-family: 'Orbitron', sans-serif; font-size: 40px; margin: 0; color: var(--gold); text-shadow: 0 0 15px rgba(255,204,0,0.3); }

        .main-coin {
            width: 220px; height: 220px; border-radius: 50%; margin: 20px auto;
            background: radial-gradient(circle at 35% 35%, #ffd700, #b8860b);
            border: 10px solid #5c4000; box-shadow: 0 0 40px rgba(255,204,0,0.2);
            display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.1s;
        }
        .main-coin:active { transform: scale(0.92); }
        .main-coin span { font-family: 'Orbitron', sans-serif; font-size: 50px; font-weight: 900; color: #5c4000; }

        .grid-menu { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .menu-btn { background: var(--glass); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; padding: 12px; text-align: center; font-size: 10px; font-weight: 700; }
        .menu-btn i { font-size: 20px; color: var(--gold); display: block; margin-bottom: 5px; }

        .p-card { background: var(--glass); border-radius: 20px; padding: 15px; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 15px; }
        .btn-p { width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: 900; font-family: 'Orbitron'; cursor: pointer; }
        .btn-gold { background: var(--gold); color: #000; }
        .btn-blue { background: var(--accent); color: #fff; }

        .nav-bar { position: fixed; bottom: 0; width: 100%; height: 75px; background: #0a0f19; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid var(--glass); }
        .nav-link { text-align: center; color: #555; font-size: 10px; font-weight: 700; }
        .nav-link.active { color: var(--gold); }
        .nav-link i { font-size: 22px; display: block; margin-bottom: 3px; }

        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 1000; align-items: center; justify-content: center; flex-direction: column; }
        .wheel-wrap { width: 280px; height: 280px; border-radius: 50%; border: 5px solid #fff; position: relative; transition: 4s cubic-bezier(0.1, 0, 0.1, 1); overflow: hidden; }

        .p-input { width: 100%; background: #111; border: 1px solid #333; padding: 12px; border-radius: 10px; color: #fff; margin: 10px 0; }
    </style>
</head>
<body>

    <div class="top-nav">
        <div class="chip">üíé <span id="elite-val">0.00</span></div>
        <div class="chip">üöÄ <span id="b-txt">BOOST OFF</span></div>
    </div>

    <div id="scr-mine" class="app-screen active-screen">
        <div class="airdrop-banner">üéÅ AIRDROP SNAPSHOT: MARCH 15, 2026</div>
        <div class="balance-container">
            <h1 id="bal-main">0</h1>
            <small>TTE BALANCE</small>
        </div>
        <div class="main-coin" onclick="handleTap(event)"><span>TTE</span></div>
        <div class="grid-menu">
            <div class="menu-btn" onclick="startAd('boost')"><i class="fas fa-bolt"></i>BOOST</div>
            <div class="menu-btn" onclick="openSpin()"><i class="fas fa-dharmachakra"></i>SPIN</div>
            <div class="menu-btn" onclick="nav('scr-tasks', this)"><i class="fas fa-tasks"></i>TASKS</div>
        </div>
        <div style="margin-top:20px;">
            <div style="display:flex; justify-content:space-between; font-size:11px; margin-bottom:5px;">
                <span>ENERGY</span><span id="en-txt">1000/1000</span>
            </div>
            <div style="height:8px; background:#222; border-radius:5px; overflow:hidden;"><div id="en-fill" style="width:100%; height:100%; background:var(--gold);"></div></div>
        </div>
    </div>

    <div id="scr-tasks" class="app-screen">
        <h2 style="font-family:'Orbitron';">TASKS</h2>
        <div id="task-list"></div>
    </div>

    <div id="scr-ref" class="app-screen">
        <h2 style="font-family:'Orbitron';">ALLIANCE</h2>
        <div class="p-card" style="text-align:center;">
            <p>Referral Bonus: 5,000 TTE + 0.01 ELITE</p>
            <h1 id="ref-count" style="color:var(--gold); font-size: 40px;">0</h1>
            <p>Total Referrals</p>
        </div>
        <input type="text" id="ref-link" class="p-input" readonly>
        <button class="btn-p btn-blue" onclick="copyRef()">INVITE FRIENDS</button>
    </div>

    <div id="scr-wallet" class="app-screen">
        <h2 style="font-family:'Orbitron';">WALLET</h2>
        <div class="p-card" style="text-align:center;">
            <small>ELITE ASSET</small>
            <h1 id="elite-wallet" style="color:var(--gold); font-size: 35px;">0.00</h1>
            <button class="btn-p btn-gold" onclick="swap()">SWAP 10M TTE ‚Üí 0.1 ELITE</button>
        </div>
        <div class="p-card">
            <p>TON Wallet (Deadline: Mar 15)</p>
            <input type="text" id="ton-addr" class="p-input" placeholder="UQ...">
            <p id="cur-addr" style="font-size:10px; color:var(--accent);"></p>
            <button class="btn-p btn-blue" onclick="saveW()">SAVE ADDRESS</button>
        </div>
    </div>

    <div id="scr-admin" class="app-screen">
        <h2>ADMIN</h2>
        <div class="p-card">
            <input type="text" id="ad-t" placeholder="Task Title" class="p-input">
            <input type="text" id="ad-l" placeholder="Task Link" class="p-input">
            <input type="number" id="ad-r" placeholder="Reward" class="p-input">
            <button class="btn-p btn-gold" onclick="addTask()">ADD TASK</button>
        </div>
        <div id="ad-task-list"></div>
    </div>

    <div id="spin-modal" class="modal">
        <div id="wheel" class="wheel-wrap">
            <canvas id="wheel-canvas" width="280" height="280"></canvas>
        </div>
        <div style="margin-top:20px; text-align:center; width:80%;">
            <p>SPINS: <span id="spin-val" style="color:var(--gold)">0</span></p>
            <button class="btn-p btn-blue" onclick="spinNow()">SPIN</button>
            <button class="btn-p btn-gold" style="margin-top:10px;" onclick="startAd('spin')">AD FOR SPIN</button>
            <button class="btn-p" style="margin-top:10px; background:#222; color:#fff;" onclick="closeSpin()">CLOSE</button>
        </div>
    </div>

    <nav class="nav-bar">
        <div class="nav-link active" onclick="nav('scr-mine', this)"><i class="fas fa-hammer"></i>Mine</div>
        <div class="nav-link" onclick="nav('scr-tasks', this)"><i class="fas fa-tasks"></i>Tasks</div>
        <div class="nav-link" onclick="nav('scr-ref', this)"><i class="fas fa-users"></i>Refer</div>
        <div class="nav-link" onclick="nav('scr-wallet', this)"><i class="fas fa-wallet"></i>Wallet</div>
    </nav>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyAn1mn3IZ6eReChizrKIZvCBt4zkOn_svU", authDomain: "tte-game.firebaseapp.com", databaseURL: "https://tte-game-default-rtdb.firebaseio.com", projectId: "tte-game", storageBucket: "tte-game.firebasestorage.app", messagingSenderId: "1067385955645", appId: "1:1067385955645:web:09b237ceaf180459311154" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database(), tg = window.Telegram.WebApp;
        const ADMIN_ID = "7178946316", userId = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id.toString() : "dev";

        let u = { bal: 0, elite: 0, energy: 1000, spins: 0, bUntil: 0, wallet: "", ref: 0, referredBy: "" };
        const rewards = ["1000", "5000", "10000", "50000", "0.1 ELITE"];
        const colors = ["#3498db", "#e74c3c", "#f1c40f", "#2ecc71", "#9b59b6"];

        // REFERRAL LOGIC
        const urlParams = new URLSearchParams(window.location.search);
        const refParent = urlParams.get('start');

        db.ref('users/' + userId).on('value', s => {
            if(s.val()) { 
                u = {...u, ...s.val()}; updateUI(); 
            } else {
                // New User Bonus & Parent Reward
                if(refParent && refParent !== userId) {
                    db.ref('users/' + refParent).once('value', ps => {
                        if(ps.val()) {
                            let p = ps.val();
                            db.ref('users/' + refParent).update({ 
                                bal: (p.bal || 0) + 5000, 
                                elite: (p.elite || 0) + 0.01, 
                                ref: (p.ref || 0) + 1 
                            });
                        }
                    });
                    u.referredBy = refParent;
                }
                db.ref('users/' + userId).set(u);
            }
        });

        if(userId === ADMIN_ID) {
            const navB = document.querySelector('.nav-bar');
            const adI = document.createElement('div'); adI.className='nav-link'; adI.innerHTML='<i class="fas fa-user-shield"></i>Admin';
            adI.onclick=()=>nav('scr-admin', adI); navB.appendChild(adI); loadAdmin();
        }

        const canvas = document.getElementById('wheel-canvas');
        const ctx = canvas.getContext('2d');
        function drawWheel() {
            const arc = (Math.PI * 2) / rewards.length;
            rewards.forEach((r, i) => {
                ctx.beginPath(); ctx.fillStyle = colors[i]; ctx.moveTo(140, 140); ctx.arc(140, 140, 140, i*arc, (i+1)*arc); ctx.fill();
                ctx.save(); ctx.translate(140,140); ctx.rotate(i*arc + arc/2); ctx.fillStyle="white"; ctx.font="bold 12px Orbitron"; ctx.fillText(r, 60, 5); ctx.restore();
            });
        }
        drawWheel();

        function startAd(type) {
            show_10499994().then(() => {
                if(type === 'boost') u.bUntil = Date.now() + (12 * 60 * 60 * 1000);
                else if(type === 'spin') u.spins++;
                db.ref('users/'+userId).update({bUntil: u.bUntil, spins: u.spins});
                tg.showAlert("Reward Added!");
            }).catch(() => tg.showAlert("Ad not ready!"));
        }

        function handleTap(e) {
            let p = (Date.now() < u.bUntil) ? 2 : 1;
            if(u.energy >= p) {
                u.bal += p; u.energy -= p;
                updateUI();
                tg.HapticFeedback.impactOccurred('light');
                db.ref('users/'+userId).update({bal: u.bal, energy: u.energy});
            }
        }

        function openSpin() { document.getElementById('spin-modal').style.display='flex'; }
        function closeSpin() { document.getElementById('spin-modal').style.display='none'; }
        function spinNow() {
            if(u.spins <= 0) return tg.showAlert("Need Spins!");
            let deg = 3600 + Math.floor(Math.random() * 360);
            canvas.style.transition = "4s cubic-bezier(0.1, 0, 0.1, 1)";
            canvas.style.transform = `rotate(${deg}deg)`;
            u.spins--; db.ref('users/'+userId).update({spins: u.spins});
            setTimeout(() => {
                let win = rewards[Math.floor(Math.random()*rewards.length)];
                if(win.includes("ELITE")) u.elite += 0.1; else u.bal += parseInt(win);
                db.ref('users/'+userId).update({bal: u.bal, elite: u.elite});
                tg.showAlert("WON: " + win);
                canvas.style.transition="none"; canvas.style.transform="rotate(0deg)";
            }, 4100);
        }

        function updateUI() {
            document.getElementById('bal-main').innerText = Math.floor(u.bal).toLocaleString();
            document.getElementById('elite-val').innerText = u.elite.toFixed(2);
            document.getElementById('elite-wallet').innerText = u.elite.toFixed(2);
            document.getElementById('spin-val').innerText = u.spins;
            document.getElementById('ref-count').innerText = u.ref;
            document.getElementById('en-txt').innerText = u.energy + "/1000";
            document.getElementById('en-fill').style.width = (u.energy/10) + "%";
            document.getElementById('ref-link').value = "https://t.me/taptoearn_tte_bot?start=" + userId;
            document.getElementById('b-txt').innerText = (Date.now() < u.bUntil) ? "BOOST ACTIVE" : "BOOST OFF";
            document.getElementById('cur-addr').innerText = u.wallet ? "Saved: " + u.wallet : "No Address Saved";
        }

        function saveW() {
            if(Date.now() > new Date("2026-03-15").getTime()) return tg.showAlert("Snapshot Closed!");
            u.wallet = document.getElementById('ton-addr').value;
            db.ref('users/'+userId).update({wallet: u.wallet});
            tg.showAlert("Address Saved!");
        }

        function swap() {
            if(u.bal >= 10000000) {
                u.bal -= 10000000; u.elite += 0.1;
                db.ref('users/'+userId).update({bal: u.bal, elite: u.elite});
                tg.showAlert("Swap Complete!");
            } else tg.showAlert("Need 10M TTE!");
        }

        function nav(id, el) {
            document.querySelectorAll('.app-screen').forEach(s => s.classList.remove('active-screen'));
            document.getElementById(id).classList.add('active-screen');
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        }

        db.ref('tasks').on('value', s => {
            const list = document.getElementById('task-list'); list.innerHTML = "";
            if(s.val()) Object.values(s.val()).forEach(t => {
                list.innerHTML += `<div class="p-card" style="display:flex; justify-content:space-between; align-items:center;">
                <div><b>${t.title}</b><br><small>+${t.reward} TTE</small></div>
                <button class="btn-p btn-blue" style="width:auto;" onclick="tg.openLink('${t.link}')">GO</button></div>`;
            });
        });

        function addTask() {
            const t = document.getElementById('ad-t').value, l = document.getElementById('ad-l').value, r = document.getElementById('ad-r').value;
            if(t && l && r) { const id = 't_'+Date.now(); db.ref('tasks/'+id).set({id, title:t, link:l, reward:parseInt(r)}); }
        }

        function loadAdmin() {
            db.ref('tasks').on('value', s => {
                const al = document.getElementById('ad-task-list'); al.innerHTML = "";
                if(s.val()) Object.values(s.val()).forEach(t => { al.innerHTML += `<div class="p-card"><span>${t.title}</span><button onclick="db.ref('tasks/${t.id}').remove()" style="color:red; background:none; border:none;">DEL</button></div>`; });
            });
        }

        function copyRef() { document.getElementById('ref-link').select(); document.execCommand('copy'); tg.showAlert("Link Copied!"); }
        setInterval(() => { if(u.energy < 1000) { u.energy++; updateUI(); }}, 1500);
    </script>
</body>
</html>
